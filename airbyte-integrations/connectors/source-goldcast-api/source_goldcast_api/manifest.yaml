version: "0.29.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: []

  requester:
    type: HttpRequester
    url_base: "https://customapi.goldcast.io"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      header: "Authorization"
      api_token: "Token {{ config['access_key'] }}"

  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "#/definitions/selector"
    paginator:
      type: NoPagination
    requester:
      $ref: "#/definitions/requester"

  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "#/definitions/retriever"

  organizations_stream:
    $ref: "#/definitions/base_stream"
    name: "organizations"
    description: "Organizations stream. Events are the base object of Goldcast."
    primary_key: "id"
    $parameters:
      path: "/core/organization/"

  events_stream:
    $ref: "#/definitions/base_stream"
    name: "events"
    description: "Events stream. Events are the base object of Goldcast."
    primary_key: "id"
    $parameters:
      path: "/event/"

  agenda_items_stream:
    $ref: "#/definitions/base_stream"
    name: "agenda_items"
    description: "Agenda items stream. Agenda items are associated to events."
    primary_key: "id"
    $parameters:
      path: "/event/agenda-item/"

  discussion_groups_stream:
    $ref: "#/definitions/base_stream"
    name: "discussion_groups"
    description: "Discussion groups stream. Discussion groups of events."
    primary_key: "id"
    $parameters:
      path: "/event/discussion-groups/"

#  webinars_stream:
#    $ref: "#/definitions/base_stream"
#    name: "webinars"
#    description: "Webinars stream. Webinares are one of the objects that compose an event."
#    primary_key: "id"
#    parent_stream_configs:
#      - type: ParentStreamConfig
#        stream: "#/definitions/events_stream"
#        parent_key: "id"
#        partition_field: "webinar_id"
#    $parameters:
#      name: "webinars"
#      primary_key: "id"
#      path: "/event/webinars/{{ stream_slice.webinar_id }}"
#    transformations:
#      - type: AddFields
#        fields:
#          - path: ["event_id"]
#            value: "'{{ stream_slice.id }}'"
#    retriever:
#      $ref: "#/definitions/retriever"
#      record_selector:
#        $ref: "#/definitions/retriever/record_selector"
#        extractor:
#          field_path: ["id", "id"]
#      requester:
#        $ref: "#/definitions/requester"
#        error_handler:
#          type: DefaultErrorHandler
#          description: "405 - cMethod \"GET\" not allowed."
#          response_filters:
#            - http_codes: [405]
#              action: IGNORE

streams:
  - "#/definitions/organizations_stream"
  - "#/definitions/events_stream"
  - "#/definitions/agenda_items_stream"
  - "#/definitions/discussion_groups_stream"
#  - "#/definitions/webinars_stream"

check:
  type: CheckStream
  stream_names:
    - "events"
    - "agenda_items"
    - "organizations"
    - "discussion_groups"

spec: 
  documentation_url: https://docs.airbyte.com/integrations/sources/exchangeratesapi
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: goldcast.io Source Spec
    type: object
    required:
      - access_key
    additionalProperties: true
    properties:
      access_key:
        type: string
        description: >-
          Your API Access Key. See <a
          href="https://help.goldcast.io/hc/en-us/articles/22931655725723-How-To-Create-an-API-Token-in-Goldcast">here</a>. The key is
          case sensitive.
        airbyte_secret: true
